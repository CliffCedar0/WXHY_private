import{l as n,a as t}from"./sizhu.CySFRyyU.js";const r=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],e=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],i={"寅":"午","午":"午","戌":"午","亥":"卯","卯":"卯","未":"卯","申":"子","子":"子","辰":"子","巳":"酉","酉":"酉","丑":"酉"},o={"甲":"寅","乙":"寅","丙":"巳","丁":"巳","戊":"巳","己":"巳","庚":"申","辛":"申","壬":"亥","癸":"亥"};function a(n){if(!n)return 0;return(6*r.indexOf(n[0])-5*e.indexOf(n[1])+60)%60+1}function u(n,t){const i=r.indexOf(n[0]),o=e.indexOf(n[1]);for(let a=0;a<10;a++){const n=e[(o+a)%12];if(n===t){return r[(i+a)%10]+n}}return""}function s(n,t,r){let e=t-1,i=n;for(let o=0;o<e;o++)i=r?i%9+1:1===i?9:i-1;return i}function f(n){const{monthGz:t,dayGz:f,isYang:c,mainYuejianGong:l,guestYuejianGong:g}=n;a(f);const h=t[1],y=i[h],m=function(n){const t=r.indexOf(n[0]),i=e.indexOf(n[1]);return"甲"+e[(i-t+12)%12]}(f),d=u(m,y),G=a(d),j=s(l,G,c),x=s(g,G,!c),S=d[0],z=u(m,o[S]),O=a(z),A=s(l,O,c),Y=s(g,O,!c),w=(n,t,r)=>{for(let e=0;e<9;e++){if(((t+e-1)%9+9)%9+1===n){return s(5,e+1,r)}}return-1};return{trueGeneralStar:d,mainGeneralGong:j,guestGeneralGong:x,wangQiYao:z,mainWangGong:A,guestWangGong:Y,mainSuperPos:w(j,A,c),guestSuperPos:w(x,Y,!c)}}const c=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],l=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],g={"子":1,"丑":2,"寅":3,"卯":3,"辰":2,"巳":5,"午":5,"未":2,"申":4,"酉":4,"戌":2,"亥":1},h={"甲":3,"乙":3,"丙":5,"丁":5,"戊":2,"己":2,"庚":4,"辛":4,"壬":1,"癸":1},y={"天蓬":1,"天芮":2,"天冲":3,"天辅":3,"天禽":2,"天心":4,"天柱":4,"天任":2,"天英":5},m={"立冬":6,"小雪":6,"大雪":6,"冬至":1,"小寒":1,"大寒":1,"立春":8,"雨水":8,"惊蛰":8,"春分":3,"清明":3,"谷雨":3,"立夏":4,"小满":4,"芒种":4,"夏至":9,"小暑":9,"大暑":9,"立秋":2,"处暑":2,"白露":2,"秋分":7,"寒露":7,"霜降":7},d=["","天蓬","天芮","天冲","天辅","天禽","天心","天柱","天任","天英"],G=["冬至","小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种"],j={"冬至":[1,7,4],"小寒":[2,8,5],"大寒":[3,9,6],"立春":[8,5,2],"雨水":[9,6,3],"惊蛰":[1,7,4],"春分":[3,9,6],"清明":[4,1,7],"谷雨":[5,2,8],"立夏":[4,1,7],"小满":[5,2,8],"芒种":[6,3,9],"夏至":[9,3,6],"小暑":[8,2,5],"大暑":[7,1,4],"立秋":[2,5,8],"处暑":[1,4,7],"白露":[9,3,6],"秋分":[7,1,4],"寒露":[6,3,9],"霜降":[5,2,8],"立冬":[6,3,9],"小雪":[5,2,8],"大雪":[4,1,7]},x={"甲子":"海中金","乙丑":"海中金","丙寅":"炉中火","丁卯":"炉中火","戊辰":"大林木","己巳":"大林木","庚午":"路旁土","辛未":"路旁土","壬申":"剑锋金","癸酉":"剑锋金","甲戌":"山头火","乙亥":"山头火","丙子":"涧下水","丁丑":"涧下水","戊寅":"城头土","己卯":"城头土","庚辰":"白蜡金","辛巳":"白蜡金","壬午":"杨柳木","癸未":"杨柳木","甲申":"泉中水","乙酉":"泉中水","丙戌":"屋上土","丁亥":"屋上土","戊子":"霹雳火","己丑":"霹雳火","庚寅":"松柏木","辛卯":"松柏木","壬辰":"长流水","癸巳":"长流水","甲午":"沙中金","乙未":"沙中金","丙申":"山下火","丁酉":"山下火","戊戌":"平地木","己亥":"平地木","庚子":"壁上土","辛丑":"壁上土","壬寅":"金箔金","癸卯":"金箔金","甲辰":"佛灯火","乙巳":"佛灯火","丙午":"天河水","丁未":"天河水","戊申":"大驿土","己酉":"大驿土","庚戌":"钗钏金","辛亥":"钗钏金","壬子":"桑柘木","癸丑":"桑柘木","甲寅":"大溪水","乙卯":"大溪水","丙辰":"沙中土","丁巳":"沙中土","戊午":"天上火","己未":"天上火","庚申":"石榴木","辛酉":"石榴木","壬戌":"大海水","癸亥":"大海水"},S=n=>x[n]||"",z={"冬至":{"上候":1,"中候":7,"下候":4},"立春":{"上候":8,"中候":5,"下候":2},"春分":{"上候":3,"中候":9,"下候":6},"立夏":{"上候":4,"中候":1,"下候":7},"夏至":{"上候":9,"中候":3,"下候":6},"立秋":{"上候":2,"中候":5,"下候":8},"秋分":{"上候":7,"中候":1,"下候":4},"立冬":{"上候":6,"中候":3,"下候":9}},O={"小寒":{"上候":2,"中候":8,"下候":5},"雨水":{"上候":9,"中候":6,"下候":3},"清明":{"上候":4,"中候":1,"下候":7},"小满":{"上候":5,"中候":2,"下候":8},"小暑":{"上候":8,"中候":2,"下候":5},"处暑":{"上候":1,"中候":4,"下候":7},"寒露":{"上候":6,"中候":9,"下候":3},"小雪":{"上候":5,"中候":8,"下候":2}},A={"大寒":{"上候":3,"中候":9,"下候":6},"惊蛰":{"上候":1,"中候":7,"下候":4},"谷雨":{"上候":5,"中候":2,"下候":8},"芒种":{"上候":6,"中候":3,"下候":9},"大暑":{"上候":9,"中候":1,"下候":4},"白露":{"上候":6,"中候":3,"下候":6},"霜降":{"上候":7,"中候":1,"下候":4},"大雪":{"上候":7,"中候":1,"下候":1}};function Y(n){if(!n||n.length<2)return 1;const t=n[0],r=n[1],e=c.indexOf(t),i=l.indexOf(r);if(-1===e||-1===i)return 1;for(let o=0;o<60;o++){const n=c[o%10],e=l[o%12];if(n===t&&e===r)return o+1}return 1}function w(n,t,r){let e=n;const i=(t-1)%9;for(let o=0;o<i;o++)e=r?e%9+1:1===e?9:e-1;return e}function b(n){if(!n||n.length<2)return"";const t=n.charAt(0),r=n.charAt(1),e=c.indexOf(t),i=l.indexOf(r);if(-1===e||-1===i)return"";const o=(i-e+12)%12;return l[(o+10)%12]+l[(o+11)%12]}const k=(n,t)=>{if(!n||!t)return"";if(n===t)return"旺";const r=(n,t)=>1===n&&3===t||3===n&&5===t||5===n&&2===t||2===n&&4===t||4===n&&1===t;if(r(t,n))return"相";if(r(n,t))return"休";const e=(n,t)=>1===n&&5===t||5===n&&4===t||3===n&&2===t||2===n&&1===t||4===n&&3===t;return e(n,t)?"囚":e(t,n)?"死":""};function P(r,e,i={}){const o=new Date(`${r}T${e}:00`),a=n.Solar.fromDate(o);let u={};if(i&&i.bazi)u={year:String(i.bazi.year||"").trim(),month:String(i.bazi.month||"").trim(),day:String(i.bazi.day||"").trim(),hour:String(i.bazi.hour||"").trim()};else{const n=t(o,i.huoshiShichen);if(!n)return{error:"四柱计算失败"};u={year:n.year,month:n.month,day:n.day,hour:n.hour}}let s="",x=0,P=!1;if(i&&i.jieqi)s=i.jieqi,P=G.includes(s);else{let n=a.getLunar().getPrevJieQi(!0);if(!n)return{error:"日期超出范围"};s=n.getName(),P=G.includes(s)}const W=u.day,p=W.charAt(0),v=W.charAt(1),D=c.indexOf(p),I=l.indexOf(v);if(-1===D||-1===I)return{error:"Invalid Day Pillar"};const N=l[(I-D%5+12)%12];x=["子","午","卯","酉"].includes(N)?0:["寅","申","巳","亥"].includes(N)?1:2;let Q=0;if(i&&i.ju)P=i.ju.isYang,Q=i.ju.juNum,s||(s="手工");else{const n=j[s];if(!n)return{error:"未知节气: "+s};Q=n[x]}const T=["上候","中候","下候"][x],q=(X=T,z[R=s]?z[R][X]||1:O[R]?O[R][X]||1:A[R]&&A[R][X]||1);var R,X;const $=Y(u.year),F=w(q,$,P),J=Y(u.month),L=w(F,J,P),Z=Y(u.day),B=w(L,Z,P),C=Y(u.hour),E=w(B,C,P);let H=10-q;5===q&&(H=8);const K=!P,M=w(H,$,K),U=w(M,J,K),V=w(U,Z,K),_=w(V,C,K),nn=["戊","己","庚","辛","壬","癸","丁","丙","乙"],tn=new Array(10).fill("");for(let n=0;n<9;n++){let t=0;if(P)t=(Q+n-1)%9+1;else{let r=Q-n;for(;r<=0;)r+=9;for(;r>9;)r-=9;t=r}tn[t]=nn[n]}const rn=new Array(10).fill("");for(let n=1;n<=9;n++){let t;K?(t=(5+n-E+9)%9,0===t&&(t=9)):(t=(5-n+E+9)%9,0===t&&(t=9)),rn[t]=d[n]}const en=rn[B],on=n=>{const t=d.indexOf(n);return t>0?tn[t]:""},an=en+" "+on(en),un=d[E],sn=new Array(10).fill("");for(let n=1;n<=9;n++){let t;P?(t=(5+n-E+9)%9,0===t&&(t=9)):(t=(5-n+E+9)%9,0===t&&(t=9)),sn[t]=d[n]}const fn=sn[B],cn=fn+" "+on(fn),ln=B;let gn=0;for(let n=1;n<=9;n++)if(sn[n]===en){gn=n;break}const hn=new Array(10).fill("");for(let n=1;n<=9;n++){const t=sn[n],r=d.indexOf(t);r>0&&(hn[n]=tn[r])}const yn={year:{gz:u.year,xk:b(u.year),ny:S(u.year)},month:{gz:u.month,xk:b(u.month),ny:S(u.month)},day:{gz:u.day,xk:b(u.day),ny:S(u.day)},hour:{gz:u.hour,xk:b(u.hour),ny:S(u.hour)}},mn=u.month.charAt(1),dn=g[Gn=mn]?g[Gn]:h[Gn]?h[Gn]:y[Gn]?y[Gn]:0;var Gn;const jn=new Array(10).fill(""),xn=new Array(10).fill("");for(let n=1;n<=9;n++){const t=sn[n];y[t]&&(jn[n]=k(y[t],dn));const r=hn[n];h[r]&&(xn[n]=k(h[r],dn))}const Sn={},zn=["旺","相","胎","没","死","囚","废","休"],On=[6,1,8,3,4,9,2,7],An=m[s]||6,Yn=On.indexOf(An);if(-1!==Yn)for(let n=0;n<8;n++){Sn[On[(Yn+n)%8]]=zn[n]}const wn={};for(let n=1;n<=9;n++)wn[n]={star:sn[n],earthStem:tn[n],skyStem:hn[n],starWS:jn[n],stemWS:xn[n],gongWS:Sn[n]||"",isTaisui:n===F,isYuejian:n===L,isRijian:n===B,isShijian:n===E};const bn=f({monthGz:u.month,dayGz:u.day,isYang:P,mainYuejianGong:L,guestYuejianGong:U});return{jieQi:s,yuan:["上元","中元","下元"][x],hou:T,juName:(P?"阳遁":"阴遁")+["一","二","三","四","五","六","七","八","九"][Q-1]+"局",bazi:u,startGong:q,taisuiGong:F,yuejianGong:L,rijianGong:B,shijianGong:E,guestTaisuiGong:M,guestYuejianGong:U,guestRijianGong:V,guestShijianGong:_,zhiFu:un,zhuXing:cn,guestZhuXing:an,mainStarPos:ln,guestStarPos:gn,wufu:bn,layout:{baziInfo:yn,gongInfo:wn,earth:tn,stars:sn,skyStem:hn}}}export{P as c,S as g};
